sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/Fragment","sap/ui/model/Sorter","sap/ui/Device","sap/ui/core/ValueState"],function(e,t,a,i,n,o,r,s){"use strict";return e.extend("com.agel.mmts.adminposummary.controller.LandingPage",{onInit:function(){this.oRouter=this.getRouter();this.oRouter.getRoute("RouteLandingPage").attachPatternMatched(this._onObjectMatched,this);var e=new t({busy:false,delay:0});this.setModel(e,"objectViewModel");var a=new t({openCount:null,confirmCount:null,dispatchCount:null});this.setModel(a,"oIconTabCountModel");this._aTableSearchState=[];this._mViewSettingsDialogs={};this.initializeFilterBar()},_onObjectMatched:function(e){var t=this.getOwnerComponent().getComponentData().startupParameters;this.type=t.Kind[0];this.byId("idIconTabBar").setSelectedKey(this.type);this.onIconTabBarChanged(this.type)},onPurchaseOrderTableUpdateFinished:function(e){this.setIconTabCount(e,e.getParameter("total"),"/openCount")},setIconTabCount:function(e,t,a){if(e.getSource().getBinding("items").isLengthFinal()){this.getView().getModel("oIconTabCountModel").setProperty(a,t)}},onPurchaseOrderPress:function(e){this._showObject(e.getSource())},_showObject:function(e){var t=this;var a=e.getBindingContext().sPath;t.getRouter().navTo("RoutePODetailPage",{POId:a.slice("/PurchaseOrderSet".length)})},onDateRangeSelectionChange:function(e){var t=e.getParameter("from"),a=e.getParameter("to"),i=e.getParameter("valid"),n=e.getSource(),o=this.byId("TextEvent");if(i){n.setValueState(s.None)}else{n.setValueState(s.Error)}this.oFilterBar.fireFilterChange(e)},onSearch:function(e){var t=this.byId("idNameInput").getValue();var n=this.byId("dateRangeSelectionId");var o=this.byId("dateRangeSelectionId").getValue();var r=this.byId("idPlantCode").getValue();var s=this.byId("idMaterialCode").getValue();var l=this.byId("idCompanyCode").getValue();var d=[];var h=[];var u=this.byId("filterbar").getBasicSearchValue();if(u){d.push(new a("PONumber",i.Contains,u));d.push(new a("MasterCompanyCode/CompanyCode",i.EQ,u));d.push(new a("ParentLineItems/MaterialCode",i.EQ,u));d.push(new a("PlantCode",i.EQ,u));d.push(new a("ParentLineItems/Name",i.Contains,u));h.push(new a(d,false))}if(t!=""){h.push(new a("PONumber",i.EQ,t))}if(o!=""){var g=new Date(n.getFrom());var c=new Date(n.getTo());h.push(new a("POReleaseDate",i.BT,g.toISOString(),c.toISOString()))}if(l!=""){h.push(new a("MasterCompanyCode/CompanyCode",i.EQ,l))}if(s!=""){h.push(new a("ParentLineItems/MaterialCode",i.EQ,s))}if(r!=""){h.push(new a("PlantCode",i.EQ,r))}var m=this.getView().byId("idPurchaseOrdersTable").getTable().getBinding("items");if(h.length==0){h.push(new a("PONumber",i.NE,""));m.filter(new a(h,true))}if(h.length>0){m.filter(new a(h,true))}},onResetFilters:function(){this.oFilterBar._oBasicSearchField.setValue("");this.byId("idNameInput").setValue("");this.byId("idMaterialCode").setValue("");this.byId("dateRangeSelectionId").setValue("");this.byId("idPlantCode").setValue("");this.byId("idCompanyCode").setValue("");var e=this.getView().byId("idPurchaseOrdersTable").getTable().getBinding("items");e.filter([]);this.oFilterBar.fireFilterChange()},onFilterChange:function(e){this.oFilterBar.fireFilterChange(e)},onViewLineItemsPress:function(e){var t=e.getSource().getParent().getBindingContextPath();var a="PO - "+e.getSource().getBindingContext().getObject().PONumber;var i={};i.controller=this;i.view=this.getView();i.sParentItemPath=t;i.title=a;if(!this.pDialog){this.pDialog=n.load({id:i.view.getId(),name:"com.agel.mmts.adminposummary.view.fragments.ViewLineItemsDialog",controller:i.controller}).then(function(e){i.view.addDependent(e);if(r.system.desktop){e.addStyleClass("sapUiSizeCompact")}e.bindElement({path:i.sParentItemPath,parameters:{expand:"ParentLineItems"}});e.setTitle(i.title);return e})}this.pDialog.then(function(e){i.view.addDependent(e);e.bindElement({path:i.sParentItemPath,parameters:{expand:"ParentLineItems"}});e.setTitle(i.title);e.open()})},onViewChildDialogClose:function(e){this.pDialog.then(function(e){e.close()})}})});